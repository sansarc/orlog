import type {IGodFavor} from "./IGodFavor.ts";
import type {IPlayer} from "../interfaces.ts";
import {Game} from "../Game.ts";

export class BaldrsInvulnerability implements IGodFavor {
    readonly name = "Baldr's Invulnerability";
    readonly totemImgPath = "/icons/baldrs-invulnerability.png";
    readonly priority = 'PRE_COMBAT';

    getCost(level: number): number {
        switch (level) {
            case 1: return 3;
            case 2: return 6;
            case 3: return 9;
        }

        return 0;
    }

    getDescription(level: number): string {
        if (level === 0) return 'Add SHIELDS or HELMETS for each die that rolled Shield or Helmet respectively.';
        return `Add ${level} SHIELDS or HELMETS per same die.`;
    }

    execute(owner: IPlayer, _opponent: IPlayer, level: number) {
        const defenses = owner.dice.filter(die =>
            (die.face === 'SHIELD' || die.face === 'HELMET') &&
            !die.isResolved
        );

        defenses.forEach(die => {
            die.addDefense(level);
        });

        Game.Notifier.info(`Baldr adds ${defenses.filter(die => die.face === 'SHIELD').length * level} Shields and ${defenses.filter(die => die.face === 'HELMET').length * level} Helmets!`);
    }
}